<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Profile</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: "Poppins", sans-serif;
            background: #0a0f2a;
            color: white;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: auto;
            background: rgba(255,255,255,0.05);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .profile-photo {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid #4b7aff;
        }

        .profile-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        h1, h2 {
            margin: 0;
            font-weight: 600;
        }

        .section {
            margin-top: 35px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .info-box {
            background: rgba(255,255,255,0.08);
            padding: 15px;
            border-radius: 10px;
        }

        .tag {
            display: inline-block;
            background: #4b7aff;
            padding: 5px 12px;
            margin: 5px;
            border-radius: 12px;
            font-size: 14px;
        }

        .social-links a {
            color: #4b7aff;
            margin-right: 15px;
            font-size: 1.5rem;
        }

        .verified {
            background: #00d26a;
            color: black;
            padding: 5px 10px;
            border-radius: 8px;
            font-weight: bold;
            display: inline-block;
            margin-top: 5px;
        }

        .not-verified {
            background: #d2002f;
            color: white;
            padding: 5px 10px;
            border-radius: 8px;
            font-weight: bold;
            display: inline-block;
            margin-top: 5px;
        }
    </style>
</head>

<body>

<div class="container">
    <div class="profile-header">
        <div class="profile-photo" id="profile-photo">
            <img src="default.png" alt="Profile">
        </div>

        <div>
            <h1 id="full-name">Loading...</h1>
            <p id="email"></p>
            <div id="verified-status"></div>
        </div>
    </div>

    <!-- Personal Info -->
    <div class="section">
        <h2><i class="fas fa-user"></i> Personal Information</h2>
        <div class="info-grid">
            <div class="info-box"><b>Username:</b> <span id="username"></span></div>
            <div class="info-box"><b>Phone:</b> <span id="phone"></span></div>
            <div class="info-box"><b>Age:</b> <span id="age"></span></div>
            <div class="info-box"><b>Gender:</b> <span id="gender"></span></div>
        </div>
    </div>

    <!-- Designation -->
    <div class="section">
        <h2><i class="fas fa-id-card"></i> Academic/Work Information</h2>
        <div id="designation-section"></div>
    </div>

    <!-- General Profile -->
    <div class="section">
        <h2><i class="fas fa-address-card"></i> About</h2>
        <p id="short-bio"></p>

        <h3>Skills</h3>
        <div id="skills-tags"></div>

        <h3>Interests</h3>
        <div id="interests-tags"></div>
    </div>

    <!-- Social -->
    <div class="section">
        <h2><i class="fas fa-globe"></i> Social Links</h2>
        <div class="social-links">
            <a href="#" id="linkedin" target="_blank"><i class="fab fa-linkedin"></i></a>
            <a href="#" id="github" target="_blank"><i class="fab fa-github"></i></a>
            <a href="#" id="portfolio" target="_blank"><i class="fas fa-link"></i></a>
        </div>
    </div>

</div>


<script>
const API_BASE_URL = "http://localhost:5000";  // Replace when deployed

let token = localStorage.getItem("token");

if (!token) {
    window.location.href = "login.html";
}

async function loadProfile() {
    try {
        let res = await fetch(`${API_BASE_URL}/api/get-profile-data`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${token}`
            }
        });

        let data = await res.json();

        if (!data.success) {
            alert("Failed to load profile");
            return;
        }

        // Personal Info
        document.getElementById("full-name").innerText = data.user_info.full_name || "No Name";
        document.getElementById("email").innerText = data.user_info.email || "";
        document.getElementById("username").innerText = data.personal_info.username || "-";
        document.getElementById("phone").innerText = data.personal_info.phone || "-";
        document.getElementById("age").innerText = data.personal_info.age || "-";
        document.getElementById("gender").innerText = data.personal_info.gender || "-";

        // Profile Photo
        if (data.personal_info.profile_photo) {
            document.getElementById("profile-photo").innerHTML =
                `<img src="${data.personal_info.profile_photo}" alt="Profile">`;
        }

        // Verified status
        if (data.designation?.is_college_email_verified) {
            document.getElementById("verified-status").innerHTML =
                `<div class="verified">Verified Student ✔</div>`;
        } else {
            document.getElementById("verified-status").innerHTML =
                `<div class="not-verified">Not Verified ❌</div>`;
        }

        // Designation Section
        const des = data.designation;
        let html = "";

        if (des.designation_type === "student") {
            html = `
                <div class="info-grid">
                    <div class="info-box"><b>Registration No:</b> ${des.registration_no}</div>
                    <div class="info-box"><b>Program:</b> ${des.program}</div>
                    <div class="info-box"><b>Department:</b> ${des.department}</div>
                    <div class="info-box"><b>Current Year:</b> ${des.current_year}</div>
                    <div class="info-box"><b>Graduation Year:</b> ${des.graduation_year}</div>
                    <div class="info-box"><b>College Email:</b> ${des.college_email}</div>
                </div>
            `;
        }

        if (des.designation_type === "faculty") {
            html = `
                <div class="info-grid">
                    <div class="info-box"><b>Faculty ID:</b> ${des.faculty_id}</div>
                    <div class="info-box"><b>Department:</b> ${des.faculty_department}</div>
                    <div class="info-box"><b>Post:</b> ${des.post}</div>
                    <div class="info-box"><b>Courses:</b> ${des.courses_taught}</div>
                    <div class="info-box"><b>Office:</b> ${des.office_location}</div>
                </div>
            `;
        }

        if (des.designation_type === "alumni") {
            html = `
                <div class="info-grid">
                    <div class="info-box"><b>Program:</b> ${des.program}</div>
                    <div class="info-box"><b>Department:</b> ${des.department}</div>
                    <div class="info-box"><b>Grad Year:</b> ${des.graduation_year}</div>
                    <div class="info-box"><b>Job Title:</b> ${des.job_title}</div>
                    <div class="info-box"><b>Company:</b> ${des.company_name}</div>
                </div>
            `;
        }

        document.getElementById("designation-section").innerHTML = html;

        // Bio
        document.getElementById("short-bio").innerText = data.general_profile.short_bio || "";

        // Skills
        let skills = (data.general_profile.skills || "").split(",");
        skills.forEach(s => {
            if (s.trim())
                document.getElementById("skills-tags").innerHTML += `<span class="tag">${s.trim()}</span>`;
        });

        // Interests
        let interests = (data.general_profile.interests || "").split(",");
        interests.forEach(i => {
            if (i.trim())
                document.getElementById("interests-tags").innerHTML += `<span class="tag">${i.trim()}</span>`;
        });

        // Social Links
        if (data.general_profile.linkedin)
            document.getElementById("linkedin").href = data.general_profile.linkedin;

        if (data.general_profile.github)
            document.getElementById("github").href = data.general_profile.github;

        if (data.general_profile.portfolio)
            document.getElementById("portfolio").href = data.general_profile.portfolio;

    } catch (error) {
        console.error("Profile load error:", error);
        alert("Error loading profile");
    }
}

loadProfile();
</script>

</body>
</html>
